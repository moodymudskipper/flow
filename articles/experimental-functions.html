<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Experimental functions • flow</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="48x48" href="../favicon-48x48.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Experimental functions">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">flow</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/simple-usage.html">Simple Usage</a>
    </li>
    <li>
      <a href="../articles/export-diagrams.html">Export Diagrams</a>
    </li>
    <li>
      <a href="../articles/addins.html">Setup and Use the Addins</a>
    </li>
    <li>
      <a href="../articles/customize.html">Customize Your Diagrams</a>
    </li>
    <li>
      <a href="../articles/nested-functions.html">Explore Nested Functions</a>
    </li>
    <li>
      <a href="../articles/advanced-debugging.html">Advanced Debugging</a>
    </li>
    <li>
      <a href="../articles/reports.html">Build reports to document functions and unit tests</a>
    </li>
    <li>
      <a href="../articles/experimental-functions.html">Experimental functions</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/moodymudskipper/flow/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Experimental functions</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/moodymudskipper/flow/blob/master/vignettes/experimental-functions.Rmd" class="external-link"><code>vignettes/experimental-functions.Rmd</code></a></small>
      <div class="hidden name"><code>experimental-functions.Rmd</code></div>

    </div>

    
    
<p>Version 0.1.0 features experimental functions to display different
kinds of flow diagrams.</p>
<p>These are not stable but already useful and since developing flow
takes time I though it’d be useful to release them as they are for the
time being. Please report issues or upvote existing ones on github if
you’d like to see more work happening there.</p>
<div class="section level2">
<h2 id="flow_view_vars">
<code>flow_view_vars()</code><a class="anchor" aria-label="anchor" href="#flow_view_vars"></a>
</h2>
<p><code><a href="../reference/flow_view_vars.html">flow_view_vars()</a></code> shows dependencies between variables in
a function, this kind of functions cannot be made completely robust but
seems to work quite well if you don’t use <code>assign</code> and don’t
reuse variable names all over the place.</p>
<p>Full lines are direct dependencies, dashed lines are dependencies
through control flow. Variables are repeated when they are modified.</p>
<p>Let’s test it on <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">tidyselect::ends_with</a></code></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tidyselect</span><span class="fu">::</span><span class="va"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span></span>
<span><span class="co">#&gt; function (match, ignore.case = TRUE, vars = NULL) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     check_match(match)</span></span>
<span><span class="co">#&gt;     vars &lt;- vars %||% peek_vars(fn = "ends_with")</span></span>
<span><span class="co">#&gt;     if (ignore.case) {</span></span>
<span><span class="co">#&gt;         vars &lt;- tolower(vars)</span></span>
<span><span class="co">#&gt;         match &lt;- tolower(match)</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;     length &lt;- nchar(vars)</span></span>
<span><span class="co">#&gt;     flat_map_int(match, ends_with_impl, vars, length)</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x5648a2ea0c70&gt;</span></span>
<span><span class="co">#&gt; &lt;environment: namespace:tidyselect&gt;</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/flow_view_vars.html">flow_view_vars</a></span><span class="op">(</span><span class="fu">tidyselect</span><span class="fu">::</span><span class="va"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span><span class="op">)</span></span></code></pre></div>
<p><img src="flow_view_vars_1.png" alt="" width="300"></p>
<p>If we don’t want to repeat the variable we can set
<code>expand = FALSE</code>, the resulting diagram doesn’t reflect the
sequence of modifications but sums up dependencies more clearly as it is
more compact.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/flow_view_vars.html">flow_view_vars</a></span><span class="op">(</span><span class="fu">tidyselect</span><span class="fu">::</span><span class="va"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span>, expand <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="flow_view_vars_2.png" alt="" width="300"></p>
<p>Use the <code>out</code> argument to export these diagrams.</p>
</div>
<div class="section level2">
<h2 id="flow_view_deps">
<code>flow_view_deps()</code><a class="anchor" aria-label="anchor" href="#flow_view_deps"></a>
</h2>
<p><code><a href="../reference/flow_view_deps.html">flow_view_deps()</a></code> shows dependencies between functions in
a package.</p>
<p>Exported functions are blue, unexported are yellow, the number of
lines of code is indicated between brackets (useful to detect small
helpers).</p>
<p>By default functions called from other non base packages are shown
but don’t create new nodes.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/flow_view_deps.html">flow_view_deps</a></span><span class="op">(</span><span class="fu">tidyselect</span><span class="fu">::</span><span class="va"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span><span class="op">)</span></span></code></pre></div>
<p><img src="flow_view_deps_1.png" alt="" width="300"></p>
<p>We can collapse those to show only packages :</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/flow_view_deps.html">flow_view_deps</a></span><span class="op">(</span><span class="fu">tidyselect</span><span class="fu">::</span><span class="va"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span>, show_imports <span class="op">=</span> <span class="st">"packages"</span><span class="op">)</span></span></code></pre></div>
<p><img src="flow_view_deps_2.png" alt="" width="300"></p>
<p>Or not show those at all :</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/flow_view_deps.html">flow_view_deps</a></span><span class="op">(</span><span class="fu">tidyselect</span><span class="fu">::</span><span class="va"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span>, show_imports <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<p><img src="flow_view_deps_3.png" alt="" width="300"></p>
<p>There are many ways to tweak the output, in particular we can :</p>
<ul>
<li>promote functions from other packages so they’ll have their own
node</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/flow_view_deps.html">flow_view_deps</a></span><span class="op">(</span><span class="fu">tidyselect</span><span class="fu">::</span><span class="va"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span>, promote <span class="op">=</span> <span class="st">"purrr::map"</span><span class="op">)</span></span></code></pre></div>
<p><img src="flow_view_deps_4.png" alt="" width="300"></p>
<ul>
<li>Demote functions from the target package to treat them as functions
from other packages.</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/flow_view_deps.html">flow_view_deps</a></span><span class="op">(</span><span class="fu">tidyselect</span><span class="fu">::</span><span class="va"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span>, demote <span class="op">=</span> <span class="st">"peek_vars"</span><span class="op">)</span></span></code></pre></div>
<p><img src="flow_view_deps_5.png" alt="" width="300"></p>
<ul>
<li>Hide a function altogether :</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/flow_view_deps.html">flow_view_deps</a></span><span class="op">(</span><span class="fu">tidyselect</span><span class="fu">::</span><span class="va"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span>, hide <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"peek_vars"</span>, <span class="st">"purrr::map"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="flow_view_deps_6.png" alt="" width="300"></p>
<ul>
<li>Trim to stop recursing after a given function:</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/flow_view_deps.html">flow_view_deps</a></span><span class="op">(</span><span class="fu">tidyselect</span><span class="fu">::</span><span class="va"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span>, trim <span class="op">=</span> <span class="st">"peek_vars"</span><span class="op">)</span></span></code></pre></div>
<p><img src="flow_view_deps_7.png" alt="" width="300"></p>
<p>Use the <code>out</code> argument to export these diagrams.</p>
</div>
<div class="section level2">
<h2 id="flow_view_shiny">
<code>flow_view_shiny()</code><a class="anchor" aria-label="anchor" href="#flow_view_shiny"></a>
</h2>
<p>#’ This function displays a shiny app’s module structure, . If you
call for instance <code><a href="../reference/flow_view_shiny.html">flow_view_shiny()</a></code> on a function that runs
the app and #’ uses both the main server and ui functions, you’ll
display the full graph of server and ui modules.</p>
<p><code><a href="../reference/flow_view_shiny.html">flow_view_shiny()</a></code> is a wrapper around
<code><a href="../reference/flow_view_deps.html">flow_view_deps()</a></code> to show the structure of a shiny app. It
assumes the app is built on top of module functions named a certain way
(adjustable through the <code>pattern</code> argument).</p>
<p>It works nicely on apps built with {golem} or follow the same kind of
structure (good practice basically), such as those that you’d build
following the recommendations in Hadley Wickham’s “Mastering Shiny”.</p>
<p>Apps that use <code><a href="https://rdrr.io/r/base/source.html" class="external-link">source()</a></code> are not well supported but it
might come as we found it’s quite common (though probably not good
practice).</p>
<p>Here’s an example using the great {esquisser} app.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/flow_view_shiny.html">flow_view_shiny</a></span><span class="op">(</span><span class="fu">esquisse</span><span class="fu">::</span><span class="va"><a href="https://dreamrs.github.io/esquisse/reference/esquisser.html" class="external-link">esquisser</a></span>, show_imports <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<p><img src="flow_view_shiny.png" alt="" width="300"></p>
<p>Use the <code>out</code> argument to export these diagrams.</p>
</div>
<div class="section level2">
<h2 id="flow_view_uses">
<code>flow_view_uses()</code><a class="anchor" aria-label="anchor" href="#flow_view_uses"></a>
</h2>
<p><code><a href="../reference/flow_view_uses.html">flow_view_uses()</a></code> is basically
<code><a href="../reference/flow_view_deps.html">flow_view_deps()</a></code> in reverse, it shows all functions that
call directly or indirectly on another function. It is not very robust
yet but it’s already useful.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/flow_view_uses.html">flow_view_uses</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">:::</span><span class="va">accum_index</span><span class="op">)</span></span></code></pre></div>
<p><img src="flow_view_uses.png" alt="" width="300"></p>
</div>
<div class="section level2">
<h2 id="flow_compare_runs">
<code>flow_compare_runs()</code><a class="anchor" aria-label="anchor" href="#flow_compare_runs"></a>
</h2>
<p><code><a href="../reference/flow_view.html">flow_compare_runs()</a></code> compares two calls to the same
function.</p>
<p>Whenever the calls diverge we color the blocks differently (orange
for <code>x</code>, green for the <code>ref</code>) and we count
separately the passes on the edges.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/flow_view.html">flow_compare_runs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rle.html" class="external-link">rle</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rle.html" class="external-link">rle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="flow_compare_runs.png" alt="" width="300"></p>
</div>
<div class="section level2">
<h2 id="flow_embed">
<code>flow_embed()</code><a class="anchor" aria-label="anchor" href="#flow_embed"></a>
</h2>
<p><code><a href="../reference/flow_embed.html">flow_embed()</a></code> can be used to embed flow diagrams into
your roxygen documentation</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Add or subtract</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' This is a useless function that adds or subtract numbers</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' See its logic in this flow diagram:</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' `r flow_embed(flow_view(add_or_subtract), "add_or_subtract")`</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' @param x string</span></span>
<span><span class="co">#' @param y string</span></span>
<span><span class="co">#' @param what "add" or "subtract"</span></span>
<span><span class="va">add_or_subtract</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">what</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"add"</span>, <span class="st">"subtract"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">what</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/match.arg.html" class="external-link">match.arg</a></span><span class="op">(</span><span class="va">what</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">what</span> <span class="op">==</span> <span class="st">"add"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">x</span> <span class="op">+</span> <span class="va">y</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">x</span> <span class="op">-</span> <span class="va">y</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Antoine Fabri.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000.</p>
</div>

      </footer>
</div>






  </body>
</html>
